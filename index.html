<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç–æ–ø–ª–∏–≤–Ω–æ–π —Å–º–µ—Å–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --bg-color: #0d1b2a;
            --section-bg: #1b263b;
            --card-bg: #2a3b4d;
            --primary-text: #e0e0e0;
            --secondary-text: #aab5c2;
            --accent-color: #80a4ff;
            --accent-glow: rgba(128, 164, 255, 0.5);
            --danger-color: #ff5555;
            --warning-color: #ffb700;
            --info-color: #55aaff;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 15px;
            background-color: var(--bg-color);
            color: var(--primary-text);
        }
        .container { max-width: 500px; margin: 0 auto; }
        h2 { text-align: center; font-weight: 600; font-size: 1.3em; line-height: 1.4; margin-bottom: 15px; margin-top: 0;}
        h3 { margin-top: 0; display: flex; align-items: center; gap: 8px; font-weight: 500; font-size: 1.1em; }
        
        .sticky-header {
            position: -webkit-sticky; position: sticky;
            top: -1px; 
            z-index: 10;
            background-color: var(--bg-color);
            padding-top: 15px;
            margin: -15px -15px 0 -15px;
            padding-left: 15px;
            padding-right: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .section {
            background-color: var(--section-bg);
            border-radius: 16px; padding: 20px; margin-bottom: 20px;
        }

        #composition-section {
            border: 2px solid white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }

        .input-group label { margin-bottom: 8px; font-weight: 500; display: block; font-size: 0.95em; }
        .input-group input {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--card-bg);
            background-color: #415a77; color: var(--primary-text); font-size: 1em;
            transition: border-color 0.2s, box-shadow 0.2s; box-sizing: border-box;
        }
        
        .component-card {
            background-color: var(--card-bg);
            border-radius: 12px; padding: 15px; margin-bottom: 15px;
        }
        .card-header { position: relative; display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .lock-checkbox { transform: scale(1.4); flex-shrink: 0; }
        .title-group { flex-grow: 1; }
        .title-group label { font-size: 1.1em; font-weight: 600; }
        .title-group .subtitle { font-size: 0.85em; color: var(--secondary-text); }
        
        .card-body, .efficiency-item .card-body {
            display: grid; grid-template-columns: 1fr auto;
            align-items: center; gap: 15px;
        }
        .efficiency-item { padding: 15px; margin-bottom: 15px; background-color: var(--card-bg); border-radius: 12px; }
        .efficiency-item .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .efficiency-item label { font-size: 1em; color: var(--primary-text); font-weight: 500;}
        
        .value-display { text-align: right; }
        .percentage { font-size: 1.2em; font-weight: 600; }
        .mass { font-size: 0.9em; color: var(--secondary-text); display: block; }

        .card-subsection {
            margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--section-bg);
        }
        .subsection-body { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 15px; }
        .subsection-body label { font-size: 0.9em; color: var(--secondary-text); }

        input[type=range] {
            -webkit-appearance: none; appearance: none;
            width: 100%; background: transparent; cursor: pointer;
            touch-action: pan-y;
        }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; background: var(--section-bg); border-radius: 3px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            margin-top: -6px; height: 18px; width: 18px;
            background: var(--accent-color); border-radius: 50%;
            border: 2px solid var(--card-bg); box-shadow: 0 0 0 2px var(--accent-glow);
        }
        
        .results p { display: flex; justify-content: space-between; margin: 12px 0; font-size: 0.95em;}
        .results p span:last-child { font-weight: 600; }
        
        #notifications-container {
            display: flex; flex-direction: column; gap: 5px;
            height: 42px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è ~1.5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            overflow-y: auto;
            visibility: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º, –Ω–æ –º–µ—Å—Ç–æ –æ—Å—Ç–∞–≤–ª—è–µ–º */
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            margin-top: 10px;
        }
        #notifications-container.visible {
            visibility: visible;
            opacity: 1;
        }

        .notification-item {
            display: flex; align-items: center; gap: 8px;
            padding: 6px 10px; border-radius: 6px; font-size: 0.8em;
            background-color: var(--card-bg); border-left: 3px solid;
            flex-shrink: 0;
        }
        .notification-item.danger { border-color: var(--danger-color); }
        .notification-item.warning { border-color: var(--warning-color); }
        .notification-item.info { border-color: var(--info-color); }
        .notification-item .icon { font-size: 1.1em; }

        .tooltip {
            position: absolute; top: -4px; right: -4px;
            display: inline-flex; align-items: center; justify-content: center;
            width: 16px; height: 16px; border-radius: 50%; border: 1px solid var(--secondary-text);
            color: var(--secondary-text); font-size: 10px; font-weight: 700;
            cursor: pointer; transition: all 0.2s;
        }
        .tooltip:hover {
            background-color: var(--accent-color); color: var(--card-bg);
            border-color: var(--accent-color); transform: scale(1.1);
        }
        .tooltip .tooltip-text {
            visibility: hidden; width: 250px; background-color: #3c4f65;
            color: #fff; text-align: left; border-radius: 8px; padding: 12px;
            position: absolute; z-index: 10; bottom: 125%; left: 50%;
            transform: translateX(-50%); opacity: 0; transition: opacity 0.3s;
            font-size: 14px; line-height: 1.5; font-weight: normal;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }

        code { background: #415a77; padding: 2px 4px; border-radius: 4px; font-family: 'Courier New', Courier, monospace;}
        .hidden { display: none !important; }
        footer { text-align: center; margin-top: 25px; font-size: 0.9em; color: var(--secondary-text); }
        .header-divider { border: none; height: 1px; background-color: var(--card-bg); margin: 15px 0; }
        
        @media (max-width: 480px) {
            h2 { font-size: 1.1em; }
            .section { padding: 15px; }
            .component-card, .efficiency-item { padding: 12px; }
            .title-group label { font-size: 1em; }
            .percentage { font-size: 1.1em; }
            .results p { font-size: 0.9em; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="sticky-header">
        <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ç–æ–ø–ª–∏–≤–Ω–æ–π —Å–º–µ—Å–∏ –¥–ª—è –≥–∞–∑–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –¢–∏–ø–∞ –ò–º–±–µ—Ä—Ç</h2>
        <div class="section">
            <div class="input-group">
                <label for="total-mass">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ—Å–∏, –∫–≥</label>
                <input type="number" id="total-mass" value="100">
            </div>
            <hr class="header-divider">
            <div class="results">
                <h3>‚ö°Ô∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
                <p><span>–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è –º–æ—â–Ω–æ—Å—Ç—å</span><span id="res-power-el">0 –∫–í—Ç</span></p>
                <p><span>–¢–µ–ø–ª–æ–≤–∞—è –º–æ—â–Ω–æ—Å—Ç—å</span><span id="res-power-th">0 –∫–í—Ç</span></p>
                <div id="notifications-container"></div>
            </div>
        </div>
    </div>

    <div class="section" id="composition-section">
        <h3>–°–æ—Å—Ç–∞–≤ —Å–º–µ—Å–∏</h3>
        <div class="component-card" id="wood-card">
            <div class="card-header">
                <input type="checkbox" class="lock-checkbox" data-id="wood"><div class="title-group"><label for="wood">–î—Ä–µ–≤–µ—Å–∏–Ω–∞</label><span class="subtitle">(–≤–æ–∑–¥—É—à–Ω–æ-—Å—É—Ö–∞—è –∏ –¥—Ä.)</span></div>
                <span class="tooltip">i<span class="tooltip-text" id="wood-tooltip-text"></span></span>
            </div>
            <div class="card-body">
                <input type="range" id="wood" min="0" max="100" value="50" step="1">
                <div class="value-display"><span class="percentage" id="wood-val">50%</span><span class="mass" id="wood-mass">(50.0 –∫–≥)</span></div>
            </div>
            <div class="card-subsection hidden" id="wood-humidity-block">
                <div class="subsection-body">
                    <label for="wood-humidity">–í–ª–∞–∂–Ω–æ—Å—Ç—å</label>
                    <div class="value-display"><span class="percentage" id="wood-humidity-val">20%</span></div>
                    <input type="range" id="wood-humidity" min="0" max="60" value="20" step="1" style="grid-column: 1/-1">
                </div>
            </div>
        </div>

        <div class="component-card" id="plastic-card">
            <div class="card-header">
                <input type="checkbox" class="lock-checkbox" data-id="plastic"><div class="title-group"><label for="plastic">–ü–ª–∞—Å—Ç–∏–∫ –ü–ù–î</label><span class="subtitle">(–∫–∞–Ω–∏—Å—Ç—Ä—ã, –ø–ª–µ–Ω–∫–∞)</span></div>
                <span class="tooltip">i<span class="tooltip-text" id="plastic-tooltip-text"></span></span>
            </div>
            <div class="card-body">
                <input type="range" id="plastic" min="0" max="100" value="50" step="1">
                <div class="value-display"><span class="percentage" id="plastic-val">50%</span><span class="mass" id="plastic-mass">(50.0 –∫–≥)</span></div>
            </div>
        </div>

        <div class="component-card" id="cellophane-card">
            <div class="card-header">
                <input type="checkbox" class="lock-checkbox" data-id="cellophane" checked><div class="title-group"><label for="cellophane">–¶–µ–ª–ª–æ—Ñ–∞–Ω</label></div>
                <span class="tooltip">i<span class="tooltip-text" id="cellophane-tooltip-text"></span></span>
            </div>
            <div class="card-body">
                <input type="range" id="cellophane" min="0" max="100" value="0" step="1" disabled>
                <div class="value-display"><span class="percentage" id="cellophane-val">0%</span><span class="mass" id="cellophane-mass">(0.0 –∫–≥)</span></div>
            </div>
        </div>

        <div class="component-card" id="rubber-card">
            <div class="card-header">
                <input type="checkbox" class="lock-checkbox" data-id="rubber" checked><div class="title-group"><label for="rubber">–ê–≤—Ç–æ–ø–æ–∫—Ä—ã—à–∫–∏</label></div>
                <span class="tooltip">i<span class="tooltip-text" id="rubber-tooltip-text"></span></span>
            </div>
            <div class="card-body">
                <input type="range" id="rubber" min="0" max="100" value="0" step="1" disabled>
                <div class="value-display"><span class="percentage" id="rubber-val">0%</span><span class="mass" id="rubber-mass">(0.0 –∫–≥)</span></div>
            </div>
        </div>

        <div class="component-card" id="rags-card">
            <div class="card-header">
                <input type="checkbox" class="lock-checkbox" data-id="rags" checked><div class="title-group"><label for="rags">–¢–∫–∞–Ω—å (—Å–∏–Ω—Ç–µ—Ç–∏–∫–∞)</label></div>
                <span class="tooltip">i<span class="tooltip-text" id="rags-tooltip-text"></span></span>
            </div>
            <div class="card-body">
                <input type="range" id="rags" min="0" max="100" value="0" step="1" disabled>
                <div class="value-display"><span class="percentage" id="rags-val">0%</span><span class="mass" id="rags-mass">(0.0 –∫–≥)</span></div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ö–ü–î</h3>
        <div class="efficiency-item">
            <div class="header">
                <label for="eff-gasifier">–ö–ü–î –ì–∞–∑–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞</label>
                <div class="value-display"><span class="percentage" id="eff-gasifier-val">66%</span></div>
            </div>
            <input type="range" id="eff-gasifier" min="10" max="95" value="66" step="1">
        </div>
        <div class="efficiency-item">
            <div class="header">
                <label for="eff-ice">–ö–ü–î –î–í–° (–Ω–∞ –≥–∞–∑–µ)</label>
                <div class="value-display"><span class="percentage" id="eff-ice-val">25%</span></div>
            </div>
            <input type="range" id="eff-ice" min="10" max="50" value="25" step="1">
        </div>
        <div class="efficiency-item">
            <div class="header">
                <label for="eff-electric">–ö–ü–î –≠–ª–µ–∫—Ç—Ä–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞</label>
                <div class="value-display"><span class="percentage" id="eff-electric-val">80%</span></div>
            </div>
            <input type="range" id="eff-electric" min="50" max="99" value="80" step="1">
        </div>
    </div>

    <div class="section formulas">
        <h3>‚öôÔ∏è –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã</h3>
        <p><b>–ù–¢–° —Å–º–µ—Å–∏:</b> <code>(–ù–¢–°‚ÇÅ√ó%‚ÇÅ) + ...</code></p>
        <p><b>–¢–µ–ø–ª–æ–≤–∞—è –º–æ—â–Ω–æ—Å—Ç—å:</b> <code>–ú–æ—â–Ω–æ—Å—Ç—å(—ç–ª–µ–∫—Ç—Ä) √ó 2.87</code></p>
    </div>
</div>

<footer><p>v2.0 | 2025 –≥. –õ–∞–≥—É–Ω–æ–≤ –°–µ—Ä–≥–µ–π.</p></footer>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const LHV_DATA = { 
        wood: 14.2,
        plastic: 43,
        cellophane: 17.5,
        rubber: 33,
        rags: 24
    };
    const MJ_TO_KCAL = 239.006;
    const THERMAL_POWER_MULTIPLIER = 2.87;

    const inputs = {
        totalMass: document.getElementById('total-mass'),
        woodHumidity: document.getElementById('wood-humidity'),
        sliders: {
            wood: document.getElementById('wood'),
            plastic: document.getElementById('plastic'),
            cellophane: document.getElementById('cellophane'),
            rubber: document.getElementById('rubber'),
            rags: document.getElementById('rags'),
        },
        efficiencies: {
            gasifier: document.getElementById('eff-gasifier'),
            ice: document.getElementById('eff-ice'),
            electric: document.getElementById('eff-electric'),
        }
    };
    
    function calculateAndDisplay() {
        const totalMass = parseFloat(inputs.totalMass.value) || 0;
        let perc = {};
        for (const id in inputs.sliders) {
            perc[id] = parseFloat(inputs.sliders[id].value);
            document.getElementById(`${id}-val`).textContent = `${Math.round(perc[id])}%`;
            const mass = (perc[id] / 100) * totalMass;
            document.getElementById(`${id}-mass`).textContent = `(${mass.toFixed(1)} –∫–≥)`;
        }

        const woodHumidity = parseFloat(inputs.woodHumidity.value);
        let lhv_wood_effective;

        if (perc.wood > 0) {
            lhv_wood_effective = 21.375 - (0.2575 * woodHumidity);
            lhv_wood_effective = Math.max(8.5, Math.min(18.8, lhv_wood_effective));
        } else {
            lhv_wood_effective = LHV_DATA.wood;
        }
        
        const activeWarnings = [];
        if (perc.wood > 0 && woodHumidity > 25) {
            activeWarnings.push({type: 'info', text: `–í–ª–∞–∂–Ω–æ—Å—Ç—å –¥—Ä–µ–≤–µ—Å–∏–Ω—ã > 25%, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–µ–Ω–∞.`});
        }
        if (perc.plastic + perc.rubber > 40) {
            activeWarnings.push({type: 'warning', text: '–í—ã—Å–æ–∫–∞—è –¥–æ–ª—è –ø–ª–∞—Å—Ç–∏–∫–∞/—Ä–µ–∑–∏–Ω—ã –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–º–æ–ª–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é.'});
        }
        if (perc.wood > 0 && perc.wood < 50) {
            activeWarnings.push({type: 'warning', text: '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∑–∞—Å–æ—Ä–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–¥–æ–ª—è –¥—Ä–µ–≤–µ—Å–∏–Ω—ã < 50%).'});
        }
        if (perc.wood > 0 && perc.wood < 30) {
            activeWarnings.push({type: 'danger', text: '–≤–Ω–∏–º–∞–Ω–∏–µ. –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —á—Ç–æ –≥–∞–∑ –±—É–¥–µ—Ç –≥–æ—Ä–µ—Ç—å –¥–≤–∏–∂–µ—Ç—Å—è –∫ –Ω—É–ª—é'});
        }
        if (perc.plastic > 0 || perc.cellophane > 0) {
            activeWarnings.push({type: 'danger', text: '–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ü–í–• –∏ —Ñ—Ç–æ—Ä–æ–ø–ª–∞—Å—Ç (—Ä–∏—Å–∫ —è–¥–æ–≤–∏—Ç—ã—Ö –≥–∞–∑–æ–≤).'});
        }

        const notificationsContainer = document.getElementById('notifications-container');
        notificationsContainer.innerHTML = '';
        
        if (activeWarnings.length > 0) {
            notificationsContainer.classList.add('visible');
            activeWarnings.forEach(warning => {
                const warningDiv = document.createElement('div');
                warningDiv.className = `notification-item ${warning.type}`;
                let icon = 'i';
                if(warning.type === 'danger') icon = 'üî¥';
                if(warning.type === 'warning') icon = 'üü†';
                if(warning.type === 'info') icon = 'üîµ';
                warningDiv.innerHTML = `<span class="icon">${icon}</span> <span>${warning.text}</span>`;
                notificationsContainer.appendChild(warningDiv);
            });
        } else {
            notificationsContainer.classList.remove('visible');
        }

        const lhv_mix = ((perc.wood * lhv_wood_effective) + (perc.plastic * LHV_DATA.plastic) + (perc.cellophane * LHV_DATA.cellophane) + (perc.rubber * LHV_DATA.rubber) + (perc.rags * LHV_DATA.rags)) / 100;
        
        const eff_gasifier = parseFloat(inputs.efficiencies.gasifier.value) / 100;
        const eff_ice = parseFloat(inputs.efficiencies.ice.value) / 100;
        const eff_electric = parseFloat(inputs.efficiencies.electric.value) / 100;

        const fuelConsumption = totalMass; 
        const totalEnergyIn = (fuelConsumption * lhv_mix) / 3.6;
        const finalPowerEl = totalEnergyIn * eff_gasifier * eff_ice * eff_electric;
        const finalPowerTh = finalPowerEl * THERMAL_POWER_MULTIPLIER;
            
        document.getElementById('res-power-el').textContent = `${finalPowerEl.toFixed(1)} –∫–í—Ç`;
        document.getElementById('res-power-th').textContent = `${finalPowerTh.toFixed(1)} –∫–í—Ç`;

        document.getElementById('wood-humidity-block').classList.toggle('hidden', perc.wood <= 0);
    }

    function normalizeSliders(changedSliderId) {
        const sliders = Object.values(inputs.sliders); let lockedTotal = 0; let unlockedSliders = [];
        for (const slider of sliders) {
            const id = slider.id; const checkbox = document.querySelector(`.lock-checkbox[data-id="${id}"]`);
            if (checkbox.checked) { lockedTotal += parseFloat(slider.value); } else { unlockedSliders.push(slider); }
        }
        const targetForUnlocked = 100 - lockedTotal;
        if (targetForUnlocked < 0) {
            alert("–°—É–º–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 100%");
            const checkbox = document.querySelector(`.lock-checkbox[data-id="${changedSliderId}"]`);
            if (checkbox.checked) checkbox.checked = false; inputs.sliders[changedSliderId].disabled = false;
            normalizeSliders(changedSliderId); return;
        }
        let unlockedCurrentTotal = 0; unlockedSliders.forEach(s => unlockedCurrentTotal += parseFloat(s.value));
        let diff = unlockedCurrentTotal - targetForUnlocked;
        let adjustableSliders = unlockedSliders.filter(s => s.id !== changedSliderId);
        if (unlockedSliders.length === 1 && unlockedSliders[0].id === changedSliderId) { unlockedSliders[0].value = targetForUnlocked;
        } else {
            let adjustableTotal = 0; adjustableSliders.forEach(s => adjustableTotal += parseFloat(s.value));
            if (adjustableTotal > 0) {
                for (const slider of adjustableSliders) { const reduction = diff * (parseFloat(slider.value) / adjustableTotal); slider.value = Math.max(0, parseFloat(slider.value) - reduction); }
            } else if (adjustableSliders.length > 0) { const reduction = diff / adjustableSliders.length; adjustableSliders.forEach(s => s.value = Math.max(0, parseFloat(s.value) - reduction)); }
        }
        let finalTotal = 0; sliders.forEach(s => finalTotal += parseFloat(s.value));
        if (Math.round(finalTotal) !== 100) {
            const mainUnlockedSlider = unlockedSliders.find(s => s.id === changedSliderId) || unlockedSliders[0];
            if (mainUnlockedSlider) { mainUnlockedSlider.value = parseFloat(mainUnlockedSlider.value) + (100 - finalTotal); }
        }
        calculateAndDisplay();
    }
    
    function populateTooltips() {
        for (const id in LHV_DATA) {
            const eff_gasifier = parseFloat(inputs.efficiencies.gasifier.value) / 100;
            const eff_ice = parseFloat(inputs.efficiencies.ice.value) / 100;
            const eff_electric = parseFloat(inputs.efficiencies.electric.value) / 100;

            const lhv = LHV_DATA[id]; let kgFor1kWh_el;
            if (id === 'wood') { kgFor1kWh_el = 1.2; } else { kgFor1kWh_el = (1 / (eff_gasifier * eff_ice * eff_electric)) * 3.6 / lhv; }
            const kgFor1kWh_th = (1 / eff_gasifier) * 3.6 / lhv;
            const kcal = (lhv * MJ_TO_KCAL).toFixed(0);
            
            const tooltipElem = document.getElementById(`${id}-tooltip-text`);
            if(tooltipElem) {
              tooltipElem.innerHTML = `–¢–µ–ø–ª–æ—Ç–≤–æ—Ä–Ω–æ—Å—Ç—å: <b>~${kcal} –∫–∫–∞–ª/–∫–≥</b><hr>–î–ª—è 1 –∫–í—Ç¬∑—á —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞: <b>${kgFor1kWh_el.toFixed(2)} –∫–≥</b><br>–î–ª—è 1 –∫–í—Ç¬∑—á —Ç–µ–ø–ª–∞ (–≤ —Å–∏–Ω–≥–∞–∑–µ): <b>${kgFor1kWh_th.toFixed(2)} –∫–≥</b>`;
            }
        }
    }

    inputs.totalMass.addEventListener('input', calculateAndDisplay);
    inputs.woodHumidity.addEventListener('input', (e) => {
        document.getElementById('wood-humidity-val').textContent = `${e.target.value}%`; calculateAndDisplay();
    });
    for (const id in inputs.sliders) {
        inputs.sliders[id].addEventListener('input', () => normalizeSliders(id));
        const checkbox = document.querySelector(`.lock-checkbox[data-id="${id}"]`);
        checkbox.addEventListener('change', () => { inputs.sliders[id].disabled = checkbox.checked; normalizeSliders(id); });
    }
    for (const id in inputs.efficiencies) {
        inputs.efficiencies[id].addEventListener('input', (e) => {
            document.getElementById(`eff-${id}-val`).textContent = `${e.target.value}%`;
            calculateAndDisplay();
            populateTooltips();
        });
    }

    window.addEventListener('load', () => {
        populateTooltips(); 
        calculateAndDisplay();
        document.getElementById('wood-humidity-val').textContent = `${inputs.woodHumidity.value}%`;
        document.getElementById('eff-gasifier-val').textContent = `${inputs.efficiencies.gasifier.value}%`;
        document.getElementById('eff-ice-val').textContent = `${inputs.efficiencies.ice.value}%`;
        document.getElementById('eff-electric-val').textContent = `${inputs.efficiencies.electric.value}%`;
    });
</script>

</body>
</html>
