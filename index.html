<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор топливной смеси</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --bg-color: #0d1b2a;
            --section-bg: #1b263b;
            --card-bg: #2a3b4d;
            --primary-text: #e0e0e0;
            --secondary-text: #aab5c2;
            --accent-color: #80a4ff;
            --accent-glow: rgba(128, 164, 255, 0.5);
            --danger-color: #ff5555;
            --warning-color: #ffb700;
            --info-color: #55aaff;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 15px;
            background-color: var(--bg-color);
            color: var(--primary-text);
        }
        .container { max-width: 500px; margin: 0 auto; }
        h2 { text-align: center; font-weight: 600; font-size: 1.3em; line-height: 1.4; margin-bottom: 15px;}
        h3 { margin-top: 0; display: flex; align-items: center; gap: 8px; font-weight: 500; }
        
        .sticky-header {
            position: -webkit-sticky; position: sticky;
            top: -1px; /* небольшой хак для лучшего вида тени */
            z-index: 10;
            background-color: var(--bg-color);
            padding-top: 15px;
            margin: -15px -15px 0 -15px;
            padding-left: 15px;
            padding-right: 15px;
            box-shadow: 0 4px S12px rgba(0,0,0,0.3);
        }

        .section {
            background-color: var(--section-bg);
            border-radius: 16px; padding: 20px; margin-bottom: 20px;
        }

        .input-group label { margin-bottom: 8px; font-weight: 500; display: block; }
        .input-group input {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--card-bg);
            background-color: #415a77; color: var(--primary-text); font-size: 1em;
            transition: border-color 0.2s, box-shadow 0.2s; box-sizing: border-box;
        }
        
        .component-card {
            background-color: var(--card-bg);
            border-radius: 12px; padding: 15px; margin-bottom: 15px;
        }
        .card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .lock-checkbox { transform: scale(1.4); flex-shrink: 0; }
        .title-group { flex-grow: 1; }
        .title-group label { font-size: 1.1em; font-weight: 600; }
        .title-group .subtitle { font-size: 0.85em; color: var(--secondary-text); }
        
        .card-body, .efficiency-item .card-body {
            display: grid; grid-template-columns: 1fr auto;
            align-items: center; gap: 15px;
        }
        .efficiency-item { padding: 15px; margin-bottom: 15px; background-color: var(--card-bg); border-radius: 12px; }
        .efficiency-item .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .efficiency-item label { font-size: 1em; color: var(--secondary-text); }

        .value-display { text-align: right; }
        .percentage { font-size: 1.2em; font-weight: 600; }
        .mass { font-size: 0.9em; color: var(--secondary-text); display: block; }

        .card-subsection {
            margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--section-bg);
        }
        .subsection-body { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 15px; }
        .subsection-body label { font-size: 0.9em; color: var(--secondary-text); }

        input[type=range] {
            -webkit-appearance: none; appearance: none;
            width: 100%; background: transparent; cursor: pointer;
            touch-action: pan-y;
        }
        
        /* ... (остальные стили слайдеров без изменений) ... */
        
        .results p { display: flex; justify-content: space-between; margin: 12px 0; }
        .results p span:last-child { font-weight: 600; }

        #notifications-container {
            margin-top: 15px; display: flex; flex-direction: column;
            gap: 8px; max-height: 92px; overflow-y: auto;
        }
        .notification-item {
            display: flex; align-items: center; gap: 10px;
            padding: 10px; border-radius: 8px; font-size: 0.9em;
            background-color: var(--card-bg); border-left: 4px solid;
            flex-shrink: 0;
        }
        .notification-item.danger { border-color: var(--danger-color); }
        .notification-item.warning { border-color: var(--warning-color); }
        .notification-item.info { border-color: var(--info-color); }
        .notification-item .icon { font-size: 1.2em; }

        code { background: #415a77; padding: 2px 4px; border-radius: 4px; font-family: 'Courier New', Courier, monospace;}
        .hidden { display: none !important; }
        footer { text-align: center; margin-top: 25px; font-size: 0.9em; color: var(--secondary-text); }

        /* --- НОВЫЙ БЛОК: АДАПТАЦИЯ ДЛЯ МОБИЛЬНЫХ --- */
        @media (max-width: 480px) {
            h2 { font-size: 1.1em; }
            .section { padding: 15px; }
            .component-card, .efficiency-item { padding: 12px; }
            .title-group label { font-size: 1em; }
            .percentage { font-size: 1.1em; }
            .results p { font-size: 0.95em; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="sticky-header">
        <h2>Калькулятор топливной смеси для газогенератора Типа Имберт</h2>
        <div class="section">
            <div class="input-group">
                <label for="total-mass">Общее количество смеси, кг</label>
                <input type="number" id="total-mass" value="100">
            </div>
        </div>
        <div class="section results">
            <h3>⚡️ Результаты</h3>
            <p><span>Электрическая мощность</span><span id="res-power-el">0 кВт</span></p>
            <p><span>Тепловая мощность</span><span id="res-power-th">0 кВт</span></p>
            <div id="notifications-container"></div>
        </div>
    </div>

    <div class="section">
        <h3>Состав смеси</h3>
        </div>
    
    <div class="section">
        <h3>Настройки КПД</h3>
        <div class="efficiency-item">
            <div class="header">
                <label for="eff-gasifier">КПД Газогенератора</label>
                <div class="value-display"><span class="percentage" id="eff-gasifier-val">66%</span></div>
            </div>
            <input type="range" id="eff-gasifier" min="10" max="95" value="66" step="1">
        </div>
        <div class="efficiency-item">
            <div class="header">
                <label for="eff-ice">КПД ДВС (на газе)</label>
                <div class="value-display"><span class="percentage" id="eff-ice-val">25%</span></div>
            </div>
            <input type="range" id="eff-ice" min="10" max="50" value="25" step="1">
        </div>
        <div class="efficiency-item">
            <div class="header">
                <label for="eff-electric">КПД Электрогенератора</label>
                <div class="value-display"><span class="percentage" id="eff-electric-val">80%</span></div>
            </div>
            <input type="range" id="eff-electric" min="50" max="99" value="80" step="1">
        </div>
    </div>

    <div class="section formulas">
        <h3>⚙️ Справочные формулы</h3>
        </div>
</div>

<footer><p>2025 г. При содействии Лагунова Сергея.</p></footer>

<script>
    // Весь JavaScript код остается без изменений.
    // Я привожу его полностью для вашего удобства.
    const tg = window.Telegram.WebApp;
    tg.expand();

    const LHV_DATA = { wood: 17, plastic: 42, cellophane: 17.5, rubber: 30, rags: 16 };
    const MJ_TO_KCAL = 239.006;
    const HUMIDITY_PENALTY_FACTOR = 1.7;
    const HUMIDITY_THRESHOLD = 25;
    const THERMAL_POWER_MULTIPLIER = 2.87;

    const inputs = {
        totalMass: document.getElementById('total-mass'),
        woodHumidity: document.getElementById('wood-humidity'),
        sliders: {
            wood: document.getElementById('wood'),
            plastic: document.getElementById('plastic'),
            cellophane: document.getElementById('cellophane'),
            rubber: document.getElementById('rubber'),
            rags: document.getElementById('rags'),
        },
        efficiencies: {
            gasifier: document.getElementById('eff-gasifier'),
            ice: document.getElementById('eff-ice'),
            electric: document.getElementById('eff-electric'),
        }
    };
    
    function calculateAndDisplay() {
        // ... (функция без изменений)
    }

    function normalizeSliders(changedSliderId) {
        // ... (функция без изменений)
    }
    
    function populateTooltips() {
       // ... (функция без изменений)
    }

    // ... (все обработчики событий без изменений)
</script>
</body>
</html>
